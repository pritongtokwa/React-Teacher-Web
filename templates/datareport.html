{% extends "base.html" %}

{% block content %}
<div class="main" style="display: flex; flex-direction: column; padding: 20px; box-sizing: border-box;">
    <div class="data-table" style="background-color: white; color: #494949; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); min-width: 0;">
        <h2 style="color: #000; margin-top:0;">Data Report</h2>

        <div class="class-buttons" style="margin-bottom: 20px;">
            {% for sec in classes %}
            <form action="{{ url_for('data_report') }}" method="get" style="display: inline-block; margin-right: 10px;">
                <input type="hidden" name="section_id" value="{{ sec.id }}">
                <button type="submit" class="{% if classname and classname == sec.name %}active{% endif %}" style="padding:10px 15px; border-radius:5px; cursor:pointer; font-weight:bold;">
                    {{ sec.name }}
                </button>
            </form>
            {% endfor %}

            {% if classname %}
            <br><br>
            <form action="{{ url_for('export_data_report', class_name=classname) }}" method="get" style="margin-bottom: 15px;">
                <button type="submit">Export Data Report to Excel</button>
            </form>
            {% endif %}
        </div>

        {% if data %}
        <div style="overflow-x: auto; min-width: 0;">
            <table style="border-collapse: collapse; width: max-content; table-layout: auto;">
                <thead>
                    <tr>
                        <th>Student Name</th>
                        <th>Section</th>
                        <th>Minigame 1 (First)</th>
                        <th>Minigame 1 (Best)</th>
                        <th>Attempts</th>
                        <th>Improvement</th>
                        <th>Minigame 2 (First)</th>
                        <th>Minigame 2 (Best)</th>
                        <th>Attempts</th>
                        <th>Improvement</th>
                        <th>Minigame 3 (First)</th>
                        <th>Minigame 3 (Best)</th>
                        <th>Attempts</th>
                        <th>Improvement</th>
                        <th>Minigame 4 (First)</th>
                        <th>Minigame 4 (Best)</th>
                        <th>Attempts</th>
                        <th>Improvement</th>
                        <th>Quiz Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in data %}
                    <tr>
                        <td>{{ entry.student_name }}</td>
                        <td>{{ entry.section_name }}</td>
                        <td>{{ entry.minigame1_first or 0 }}</td>
                        <td>{{ entry.minigame1_best or 0 }}</td>
                        <td>{{ entry.minigame1_attempts or 0 }}</td>
                        <td>{{ (entry.minigame1_best - entry.minigame1_first) if entry.minigame1_first is not none else 0 }}</td>
                        <td>{{ entry.minigame2_first or 0 }}</td>
                        <td>{{ entry.minigame2_best or 0 }}</td>
                        <td>{{ entry.minigame2_attempts or 0 }}</td>
                        <td>{{ (entry.minigame2_best - entry.minigame2_first) if entry.minigame2_first is not none else 0 }}</td>
                        <td>{{ entry.minigame3_first or 0 }}</td>
                        <td>{{ entry.minigame3_best or 0 }}</td>
                        <td>{{ entry.minigame3_attempts or 0 }}</td>
                        <td>{{ (entry.minigame3_best - entry.minigame3_first) if entry.minigame3_first is not none else 0 }}</td>
                        <td>{{ entry.minigame4_first or 0 }}</td>
                        <td>{{ entry.minigame4_best or 0 }}</td>
                        <td>{{ entry.minigame4_attempts or 0 }}</td>
                        <td>{{ (entry.minigame4_best - entry.minigame4_first) if entry.minigame4_first is not none else 0 }}</td>
                        <td>{{ entry.quiz_score or 0 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No students found in this class.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
